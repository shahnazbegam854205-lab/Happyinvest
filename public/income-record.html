<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Records - Happy Invest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: white;
            font-size: 28px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .amount {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-card .subtitle {
            color: #888;
            font-size: 14px;
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        .filter-btn {
            padding: 10px 25px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .filter-btn:hover:not(.active) {
            background: #f0f2ff;
        }

        .date-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .date-filter input {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 50px;
            font-size: 14px;
        }

        .records-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .records-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 20px;
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
            border-bottom: 2px solid #eee;
        }

        .records-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .record-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            padding: 20px;
            border-bottom: 1px solid #eee;
            transition: background 0.3s ease;
        }

        .record-item:hover {
            background: #f9f9f9;
        }

        .record-item:last-child {
            border-bottom: none;
        }

        .record-type {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .type-daily { background: #e3f2fd; color: #1976d2; }
        .type-commission { background: #f3e5f5; color: #7b1fa2; }
        .type-gift { background: #e8f5e9; color: #388e3c; }
        .type-checkin { background: #fff3e0; color: #f57c00; }

        .amount-positive {
            color: #2e7d32;
            font-weight: bold;
        }

        .amount-negative {
            color: #c62828;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .no-records {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 20px;
            background: #f8f9fa;
        }

        .page-btn {
            padding: 10px 15px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn:hover:not(.active) {
            background: #f0f0f0;
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .records-header,
            .record-item {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .filters {
                flex-direction: column;
            }
            
            .date-filter {
                margin-left: 0;
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üìä Income Records</h1>
            <button class="back-btn" onclick="goBack()">
                ‚Üê Back to Dashboard
            </button>
        </div>

        <!-- Stats Cards -->
        <div class="stats-cards">
            <div class="stat-card">
                <h3>Total Earnings</h3>
                <div class="amount" id="totalEarnings">‚Çπ0</div>
                <div class="subtitle">All Time Income</div>
            </div>
            
            <div class="stat-card">
                <h3>Today's Income</h3>
                <div class="amount" id="todayIncome">‚Çπ0</div>
                <div class="subtitle">Income from today</div>
            </div>
            
            <div class="stat-card">
                <h3>Referral Earnings</h3>
                <div class="amount" id="referralIncome">‚Çπ0</div>
                <div class="subtitle">From team commissions</div>
            </div>
            
            <div class="stat-card">
                <h3>Available Balance</h3>
                <div class="amount" id="availableBalance">‚Çπ0</div>
                <div class="subtitle">Ready to withdraw</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <button class="filter-btn active" onclick="filterRecords('all')">All Income</button>
            <button class="filter-btn" onclick="filterRecords('daily')">Daily Income</button>
            <button class="filter-btn" onclick="filterRecords('commission')">Referral Commission</button>
            <button class="filter-btn" onclick="filterRecords('gift')">Gifts & Check-ins</button>
            
            <div class="date-filter">
                <input type="date" id="startDate" onchange="filterByDate()">
                <span>to</span>
                <input type="date" id="endDate" onchange="filterByDate()">
            </div>
        </div>

        <!-- Records List -->
        <div class="records-container">
            <div class="records-header">
                <div>Description</div>
                <div>Type</div>
                <div>Date & Time</div>
                <div>Amount</div>
            </div>
            
            <div class="records-list" id="recordsList">
                <!-- Records will be loaded here -->
                <div class="loading">Loading income records...</div>
            </div>
            
            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be added here -->
            </div>
        </div>
    </div>

    <script>
        // User data - Replace with actual user ID
        const userId = localStorage.getItem('userId') || 'demo_user';
        let currentFilter = 'all';
        let currentPage = 1;
        let allRecords = [];
        let filteredRecords = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            loadIncomeRecords();
        });

        // Load user stats
        async function loadUserData() {
            try {
                // Try to fetch from API
                const response = await fetch(`https://richday.vercel.app/api/income-stats/${userId}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        updateStats(data);
                        return;
                    }
                }
            } catch (error) {
                console.log('Using demo data');
            }
            
            // Fallback demo data
            updateStats({
                todayIncome: 450,
                totalIncome: 12500,
                referralIncome: 2200,
                regularBalance: 3200
            });
        }

        // Update stats display
        function updateStats(data) {
            document.getElementById('totalEarnings').textContent = `‚Çπ${data.totalIncome || 0}`;
            document.getElementById('todayIncome').textContent = `‚Çπ${data.todayIncome || 0}`;
            document.getElementById('referralIncome').textContent = `‚Çπ${data.referralIncome || 0}`;
            document.getElementById('availableBalance').textContent = `‚Çπ${data.regularBalance || 0}`;
        }

        // Load income records
        async function loadIncomeRecords() {
            try {
                // Try to fetch from API
                const response = await fetch(`https://richday.vercel.app/api/income-records/${userId}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        allRecords = data.records || generateDemoRecords();
                        filterRecords('all');
                        return;
                    }
                }
            } catch (error) {
                console.log('Using demo records');
            }
            
            // Generate demo records
            allRecords = generateDemoRecords();
            filterRecords('all');
        }

        // Generate demo records for testing
        function generateDemoRecords() {
            const records = [];
            const types = ['daily_income', 'referral_commission', 'gift_code', 'checkin'];
            const descriptions = [
                'Daily income from Basic ‚Çπ608 plan',
                'Referral commission from Amit Kumar',
                'Welcome gift bonus',
                'Daily check-in reward',
                'Income from VIP ‚Çπ3000 plan',
                'Referral from Priya Singh',
                'Festival bonus gift',
                '7-day streak reward'
            ];
            
            const now = new Date();
            
            for (let i = 0; i < 50; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const date = new Date(now - i * 24 * 60 * 60 * 1000);
                const amount = type === 'daily_income' ? 
                    Math.floor(Math.random() * 500) + 100 :
                    type === 'referral_commission' ? 110 :
                    type === 'gift_code' ? Math.floor(Math.random() * 200) + 50 :
                    Math.floor(Math.random() * 100) + 20;
                
                records.push({
                    id: `record_${i}`,
                    type: type,
                    amount: amount,
                    date: date.toISOString(),
                    description: descriptions[Math.floor(Math.random() * descriptions.length)],
                    status: 'completed'
                });
            }
            
            return records;
        }

        // Filter records
        function filterRecords(type) {
            currentFilter = type;
            currentPage = 1;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter records
            if (type === 'all') {
                filteredRecords = allRecords;
            } else if (type === 'daily') {
                filteredRecords = allRecords.filter(r => r.type === 'daily_income');
            } else if (type === 'commission') {
                filteredRecords = allRecords.filter(r => r.type === 'referral_commission');
            } else if (type === 'gift') {
                filteredRecords = allRecords.filter(r => r.type === 'gift_code' || r.type === 'checkin');
            }
            
            displayRecords();
        }

        // Filter by date
        function filterByDate() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            if (!startDate || !endDate) return;
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            end.setHours(23, 59, 59, 999);
            
            filteredRecords = allRecords.filter(record => {
                const recordDate = new Date(record.date);
                return recordDate >= start && recordDate <= end;
            });
            
            currentPage = 1;
            displayRecords();
        }

        // Display records with pagination
        function displayRecords() {
            const recordsPerPage = 10;
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const pageRecords = filteredRecords.slice(startIndex, endIndex);
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            
            const recordsList = document.getElementById('recordsList');
            
            if (filteredRecords.length === 0) {
                recordsList.innerHTML = `
                    <div class="no-records">
                        <h3>No income records found</h3>
                        <p>Try changing your filters or check back later</p>
                    </div>
                `;
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            let html = '';
            pageRecords.forEach(record => {
                const date = new Date(record.date);
                const typeClass = getTypeClass(record.type);
                const typeLabel = getTypeLabel(record.type);
                
                html += `
                    <div class="record-item">
                        <div>
                            <div style="font-weight: bold; margin-bottom: 5px;">${record.description}</div>
                            <div style="font-size: 12px; color: #666;">Transaction ID: ${record.id}</div>
                        </div>
                        <div>
                            <span class="record-type ${typeClass}">${typeLabel}</span>
                        </div>
                        <div>
                            <div>${date.toLocaleDateString()}</div>
                            <div style="font-size: 12px; color: #666;">${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                        </div>
                        <div>
                            <div class="amount-positive">+‚Çπ${record.amount}</div>
                            <div style="font-size: 12px; color: #666;">Completed</div>
                        </div>
                    </div>
                `;
            });
            
            recordsList.innerHTML = html;
            updatePagination(totalPages);
        }

        // Update pagination
        function updatePagination(totalPages) {
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            html += `<button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">‚Üê Previous</button>`;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span style="padding: 10px;">...</span>`;
                }
            }
            
            // Next button
            html += `<button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">Next ‚Üí</button>`;
            
            pagination.innerHTML = html;
        }

        // Change page
        function changePage(page) {
            currentPage = page;
            displayRecords();
            window.scrollTo({ top: 400, behavior: 'smooth' });
        }

        // Get type class
        function getTypeClass(type) {
            switch(type) {
                case 'daily_income': return 'type-daily';
                case 'referral_commission': return 'type-commission';
                case 'gift_code': return 'type-gift';
                case 'checkin': return 'type-checkin';
                default: return 'type-daily';
            }
        }

        // Get type label
        function getTypeLabel(type) {
            switch(type) {
                case 'daily_income': return 'Daily Income';
                case 'referral_commission': return 'Commission';
                case 'gift_code': return 'Gift Bonus';
                case 'checkin': return 'Check-in';
                default: return 'Income';
            }
        }

        // Go back to dashboard
        function goBack() {
            window.location.href = 'dashboard.html';
        }

        // Export to CSV
        function exportToCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Date,Description,Type,Amount,Status\n"
                + filteredRecords.map(record => 
                    `${new Date(record.date).toLocaleDateString()},"${record.description}",${getTypeLabel(record.type)},‚Çπ${record.amount},Completed`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `income_records_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Add export button to header
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.header');
            const exportBtn = document.createElement('button');
            exportBtn.className = 'back-btn';
            exportBtn.innerHTML = 'üì• Export CSV';
            exportBtn.onclick = exportToCSV;
            exportBtn.style.marginLeft = '10px';
            header.appendChild(exportBtn);
        });
    </script>
</body>
</html>